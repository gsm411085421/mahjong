<style type="text/css">
    td{
        text-align: center;
    }
</style>

<section class="content-header">
  <h1>
    {$header}
    <small>{$desc}</small>
  </h1>
</section>

<section class="content" style="">
    <div class="box-body">
        <table class="table table-bordered">
            <tr>
                <td>序号</td>
                <td>会员ID</td>
                <td>商品ID</td>
                <td>订单编号</td>
                <td>订单创建时间</td>
                <td>订单处理时间</td>
                <td>是否处理</td>
                <td>操作</td>
            </tr>
            {volist name='list' id='v'}
            <tr>
                <td>{$i}</td>
                <td>{$v.member_nickname}</td>
                <td>{$v.goods_id}</td>
                <td>{$v.order_num}</td>
                <td>{$v.create_at}</td>
                <td>{$v.update_at}</td>
                <td>
                    {eq name="v.status" value="1"}
                    <span class="label label-success" onclick="handle.changeStatus(this,{$v.id},{$v.status})" style="cursor:pointer" >已处理</span>
                    {else/}
                    <span class="label label-default" onclick="handle.changeStatus(this,{$v.id},{$v.status})" style="cursor:pointer" >未处理</span>
                    {/eq}
                </td>
                <td>
                   <button type="button" class="btn btn-warning" data-toggle="tooltip" data-placement="bottom" data-title="删除" onclick="handle.delete(this,{$v.id});">
                    <i class="fa fa-trash"></i>
                   </button>
                </td>
            </tr>
            {/volist}
        </table>
        <div style="text-align: right;">{$list->render()}</div>
    </div>
</section>


<script type="text/javascript">

    var index;//table中tr的下标

    var requestUrl = {
        changeStatus : "{:url('Order/changeStatus')}",
        delete : "{:url('Order/deleteOrder')}"
    };

    var handle = {
        /*将未处理的状态改变为处理*/
        changeStatus : function(obj,id,status){
            if(status==1){
                var e = { msg : '已经处理过的业务不能再更改'} ;
                bayMax.warning(e.msg);
            }else{
                var status = 1;
            }
            index = $(obj).parents('tr').index();
            var data = {id:id,status:status};
            $.post(requestUrl.changeStatus,data,function(e){
                if(e.code==1){
                    $(".table.table-bordered tr").eq(index).find('td:eq(6) span').html('已处理').attr({class:'label label-success',onclick:'handle.changeStatus(this,'+id+',1)'});
                    $(".table.table-bordered tr").eq(index).find('td:eq(5)').html(getNowTime());
                }
            })
        },
        /*删除一条订单*/
        delete : function(obj,id){
            bayMax.deleteConfirm(function(){
                $.post(requestUrl.delete,{id:id},function(e){
                    if(e==1) {
                        bayMax.msg(e.msg,function(){
                            $(obj).parents('tr').remove();
                        });
                    } else {
                        bayMax.warning(e.msg);
                    }
                })
            })
        }


    };

    //获取当前日期时间
    function getNowTime() {  
            var nowtime = new Date();  
            var year = nowtime.getFullYear();  
            var month = padleft0(nowtime.getMonth() + 1);  
            var day = padleft0(nowtime.getDate());  
            var hour = padleft0(nowtime.getHours());  
            var minute = padleft0(nowtime.getMinutes());  
            var second = padleft0(nowtime.getSeconds());   
            return year + "-" + month + "-" + day + " " + hour + ":" + minute + ":" + second ;  
    } 

    //将时间补齐位数
    function padleft0(obj) {  
        return obj.toString().replace(/^[0-9]{1}$/, "0" + obj);  
    }  

</script>


