<section class="content-header">
  <h1>
    {$header}
    <small>{$desc}</small>
  </h1>
</section>
<section class="content">
    <form class="form-horizontal">
        <div class="form-group">  
            <label  for="inputName" class="col-sm-2 control-label">商品名称:</label>
            <div class="col-sm-8">
                <input id="goodsName" type="text" class="form-control" id="inputEmail3" placeholder="请输入商品名称">
            </div>
        </div> 
        <div class="form-group">  
            <label for="inputPrice" class="col-sm-2 control-label">商品价格:</label>
            <div class="col-sm-8">
                <input id="goodsPrice" type="text" class="form-control" id="inputEmail3" placeholder="请输入商品价格">
            </div>
        </div>
        <div class="form-group">  
            <label for="inputNum" class="col-sm-2 control-label">商品数量:</label>
            <div class="col-sm-8">
                <input id="goods_num" type="text" class="form-control" id="inputEmail3" placeholder="请输入商品数量">
            </div>
        </div>
        <div class="form-group">  
            <label for="inputDetail" class="col-sm-2 control-label">商品详情:</label>
            <div class="col-sm-8">
                <textarea id="editor" type="text/plain" style="height:400px;"></textarea>
            </div>
        </div>
        <div class="form-group">
            <label for="inputImg" class="col-sm-2 control-label">商品图片:</label>
            <div class="col-sm-8">
                <input id="input-4" name="image" type="file" multiple class="file-loading">
            </div>
        </div>   
        <div style="display: none;">
            <input id="imgUrl" type="text" name="">
        </div>
        <div class="form-group"> 
            <div class="col-sm-8 col-sm-offset-2">
                <button type="button"  onclick="handle.save()" class="btn btn-primary">保存</button>
                <button onclick="javascript:history.back(-1);" type="button" class="btn btn-default pull-right" data-dismiss="modal">返回</button>
            </div>
        </div>
    </form>
</section>

<script type="text/javascript">

    var requestUrl = {
        save : "{:url('Goods/saveGoods')}",
        upload : "{:url('Goods/upload')}",
        lists : "{:url('Goods/goodsManage')}"
    };

    var handle = {
        /*添加商品*/
        save : function(){
            var goodsName = $("#goodsName").val();
            var goodsPrice = $("#goodsPrice").val();
            var goodsNum = $("#goods_num").val();
            var goodDetail = ue.getContent();
            var goodImg = $("#imgUrl").val();
            var data = {name:goodsName,price:goodsPrice,goods_img:goodImg,goods_num:goodsNum,
                goods_detail:goodDetail};
            console.log(data);
            $.post(requestUrl.save,data,function(e){
                if(e.code==1){
                    bayMax.msg(e.msg,function(){
                        {literal}
                        $.pjax({ url: requestUrl.lists , container: '#pjax-container'});
                        {/literal}
                    });
                }else{
                    bayMax.warning(e.msg);
                }
            })
        },


    };

    //添加商品中的文件上传
    $("#input-4").fileinput({
        language: 'zh', //设置语言
        uploadUrl: requestUrl.upload, //上传的地址
        allowedFileExtensions : ['jpg', 'png','gif'],//接收的文件后缀,
        maxFileCount: 1,
        enctype: 'multipart/form-data',
        showUpload: true, //是否显示上传按钮
        showCaption: false,//是否显示标题
        browseClass: "btn btn-primary", //按钮样式             
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>", 
        msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
    }).on("fileuploaded", function(event, data) {
        if(data.response){
            var imgMsg = data.response;
            $("#imgUrl").val(imgMsg.data);
        }
    });

    //编辑器
    var ue = new UE.ui.Editor({
    toolbars:[['fullscreen',  'undo', 'redo', '|','bold', 'italic',   'formatmatch', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist',  '|', 'fontfamily', 'fontsize', '|','justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'link', 'unlink',  '|','simpleupload', 'insertimage']],
    textarea:'content' ,
    // initialFrameWidth:800 ,//初始化宽
    initialFrameHeight:400 ,//初始化高
    wordCount:true,          //是否开启字数统计
    maximumWords:1000,       //允许的最大字符数
    utoHeightEnabled:true,//  是否自动长高,默认true
    });    
    ue.render('editor');


</script>