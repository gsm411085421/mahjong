<section class="content-header">
  <h1>
    {$header}
    <small>{$desc}</small>
  </h1>
</section>
<section class="content">
    <div class="box">
        <div class="box-body">
            <form class="form-horizontal">
                <div class="form-group">  
                    <label  for="inputName" class="col-sm-2 control-label">商品名称:</label>
                    <div class="col-sm-8">
                        <input id="editName"  type="text" value="{$list.name}" class="form-control" id="inputEmail3" placeholder="请输入商品名称">
                    </div>
                </div>
                <div class="form-group">  
                    <label  for="inputstandard" class="col-sm-2 control-label">商品规格:</label>
                    <div class="col-sm-8">
                        <input id="goodsStandard" type="text" value="{$list.goods_standard}" class="form-control" id="inputEmail3" placeholder="请输入商品规格">
                    </div>
                </div> 
                <div class="form-group">  
                    <label for="inputPrice" class="col-sm-2 control-label">商品价格:</label>
                    <div class="col-sm-8">
                    <input id="editPrice"  type="text" value="{$list.price}" class="form-control" id="inputEmail3" placeholder="请输入商品价格">
                    </div>
                </div> 
                <div class="form-group">  
                    <label for="inputNum" class="col-sm-2 control-label">商品数量:</label>
                    <div class="col-sm-8">
                        <input id="editNum"  type="text" value="{$list.goods_num}" class="form-control" id="inputEmail3" placeholder="请输入商品数量">
                    </div>
                </div>
                <div class="form-group">  
                    <label for="inputDetail" class="col-sm-2 control-label">商品详情:</label>
                    <div class="col-sm-8">
                        <textarea id="editor" type="text/plain" style="height:400px;"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputImg" class="col-sm-2 control-label">商品图片:</label>
                    <div class="col-sm-8">
                        <input id="input-2" name="image" type="file" multiple class="file-loading">
                    </div>
                </div> 
                <div class="form-group">
                    <div class="col-sm-8 col-sm-offset-2">
                        <button onclick="javascript:history.back(-1);" type="button" class="btn btn-default pull-right" data-dismiss="modal">返回</button>
                        <button type="button" onclick="handle.changeGoods()"  class="btn btn-primary">保存</button>
                    </div>
                </div>
                <div style="display: none;">
                    <input id="editImg" value="{$list.goods_img}" type="text">
                </div>
            </form>
        </div>
    </div>
</section>

<script type="text/javascript">
    
    var requestUrl = {
        change : "{:url('Goods/changeGoods')}",
        upload : "{:url('Goods/upload')}"
    };

    var handle = {
        /*修改商品信息*/
        changeGoods : function(){
            var id = {$list.id};
            var name = $('#editName').val();
            var goodsStandard = $("#goodsStandard").val();
            var price = $('#editPrice').val();
            var goods_num = $('#editNum').val();
            var goods_img =  $("#editImg").val();
            var goods_detail = ue.getContent();
            var data = {id:id,name:name,price:price,goods_num:goods_num,goods_img:goods_img,goods_detail:goods_detail};
            $.post(requestUrl.change,data,function(e){
                if(e.code==1){
                    bayMax.msg(e.msg,function(){
                        history.back(-1);
                    })  
                }else{
                    bayMax.warning(e.msg);
                }
            })
        },

    };

    //模态框中的图片上传
    $("#input-2").fileinput({
        language: 'zh', //设置语言
        uploadUrl: requestUrl.upload, //上传的地址
        allowedFileExtensions : ['jpg', 'png','gif'],//接收的文件后缀,
        maxFileCount: 1,
        enctype: 'multipart/form-data',
        showUpload: true, //是否显示上传按钮
        showCaption: false,//是否显示标题
        browseClass: "btn btn-primary", //按钮样式             
        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>", 
        msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
    }).on("fileuploaded", function(event, data) {
        if(data.response){
            var imgMsg = data.response;
            $("#editImg").val(imgMsg.data);
        }
    });

    //将图片写入图片预览位置
    $('#input-2').fileinput('refresh', {
        initialPreview:'<img src="'+"{$list.goods_img}"+'" class="file-preview-image" alt="" title="">',
    });

    //编辑器
    var ue = new UE.ui.Editor({
        toolbars:[['fullscreen',  'undo', 'redo', '|','bold', 'italic', 'formatmatch', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist',  '|', 'fontfamily', 'fontsize', '|','justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'link', 'unlink',  '|','simpleupload', 'insertimage']],
        textarea:'content' ,
        // initialFrameWidth:800 ,//初始化宽
        initialFrameHeight:400 ,//初始化高
        wordCount:true,          //是否开启字数统计
        maximumWords:1000,       //允许的最大字符数
        utoHeightEnabled:true,//  是否自动长高,默认true
    });    
    ue.render('editor');

    //将商品详情写入编译器中
    var content = '{$list.goods_detail}'; 
    ue.addListener("ready", function () { 
        ue.setContent(content); 
    }); 

   
</script>